Bootstrap: docker
From: python:3.12.4-slim-bookworm

%post
    export PIP_ROOT_USER_ACTION=ignore
    export PIP_DISABLE_PIP_VERSION_CHECK=1

    # cache folders setup
    export HUGGINGFACE_HUB_CACHE="/usr/local/share/huggingface"
    export NLTK_CACHE="/usr/local/share/nltk_data"
    mkdir ${NLTK_CACHE}
    
    # OS dependencies
    apt update
    apt install -y procps

    # speechmetryflow install
    if [ "{{DEVICE}}" = "cpu" ]
    then
        # torch cpu: https://pytorch.org/get-started/previous-versions/
        echo pip install torch~=2.9.0 --index-url https://download.pytorch.org/whl/cpu
    fi
    pip install {{APP_NAME}}=={{APP_VERSION}}
    smf_download

%environment
    export HUGGINGFACE_HUB_CACHE="/usr/local/share/huggingface"
    export NLTK_CACHE="/usr/local/share/nltk_data"
